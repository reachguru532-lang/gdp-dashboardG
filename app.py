import streamlit as st\nimport pandas as pd\nimport time\nfrom pathlib import Path\n\nst.set_page_config(page_title='Commander Guru E-Mart', page_icon='üõí', layout='wide')\n\nst.markdown('''\n<style>\nimg { object-fit: contain; max-width: 100%; height: auto; }\n.price { font-weight: 700; color: #FFD700; }\n.hero { background: linear-gradient(90deg, rgba(0,26,0,1) 0%, rgba(0,77,0,1) 100%); padding: 18px; border-radius: 8px; color: #fff; }\n.product-card { border-radius: 8px; padding: 8px; background: rgba(255,255,255,0.02); margin-bottom: 8px; }\n</style>\n''', unsafe_allow_html=True)\n\n# Load products\nproducts_path = Path('products.csv')\nif products_path.exists():\n    PRODUCTS = pd.read_csv(products_path).to_dict(orient='records')\nelse:\n    PRODUCTS = []\n\n# Session state\nif 'cart' not in st.session_state:\n    st.session_state.cart = {}\nif 'orders' not in st.session_state:\n    st.session_state.orders = []\n\ndef add_to_cart(pid, qty):\n    cart = st.session_state.cart\n    cart[str(pid)] = cart.get(str(pid), 0) + int(qty)\n    st.session_state.cart = cart\n\ndef remove_from_cart(pid):\n    cart = st.session_state.cart\n    if str(pid) in cart:\n        del cart[str(pid)]\n    st.session_state.cart = cart\n\ndef get_cart_items():\n    items = []\n    for pid, qty in st.session_state.cart.items():\n        for p in PRODUCTS:\n            if str(p['id']) == str(pid):\n                item = p.copy()\n                item['qty'] = int(qty)\n                item['total'] = item['price'] * item['qty']\n                items.append(item)\n    return items\n\n# Header\ncol1, col2 = st.columns([1,4])\nwith col1:\n    if Path('images/product_1.png').exists():\n        st.image('images/product_1.png', width=96)\nwith col2:\n    st.markdown('<div class="hero"><h1>Commander Guru E-Mart</h1><p>Buy Smart, Buy Sharp ‚öîÔ∏è</p></div>', unsafe_allow_html=True)\n\nst.markdown('---')\n\n# Layout\nleft, right = st.columns([3,1])\nwith left:\n    st.header('Catalog')\n    cats = ['All'] + sorted(list({p['category'] for p in PRODUCTS})) if PRODUCTS else ['All']\n    cat = st.selectbox('Category', cats)\n    display = PRODUCTS if cat == 'All' else [p for p in PRODUCTS if p['category'] == cat]\n    cols = st.columns(2)\n    for i, p in enumerate(display):\n        c = cols[i % 2]\n        with c:\n            st.markdown('<div class="product-card">', unsafe_allow_html=True)\n            img = Path(p.get('image',''))\n            if img.exists():\n                st.image(str(img), use_column_width=True)\n            else:\n                st.write('No image available')\n            st.markdown(f"**{p['name']}**")\n            st.write(f"Category: {p['category']}")\n            st.markdown(f"<div class='price'>‚Çπ{int(p['price']):,}</div>", unsafe_allow_html=True)\n            q = st.number_input(f"Qty_{p['id']}", min_value=1, max_value=10, value=1, key=f"qty_{p['id']}")\n            if st.button('Add to Cart', key=f"add_{p['id']}"):\n                add_to_cart(p['id'], q)\n                st.success('Added to cart')\n                st.experimental_rerun()\n            st.markdown('</div>', unsafe_allow_html=True)\n\nwith right:\n    st.header('Cart')\n    items = get_cart_items()\n    if not items:\n        st.info('Cart is empty. Add items to begin checkout.')\n    else:\n        total = 0\n        for it in items:\n            st.write(f"{it['name']} x {it['qty']} ‚Äî ‚Çπ{int(it['total']):,}")\n            if st.button('Remove', key=f"remove_{it['id']}"):\n                remove_from_cart(it['id'])\n                st.experimental_rerun()\n            total += it['total']\n        st.markdown('---')\n        st.markdown(f"**Subtotal:** ‚Çπ{int(total):,}")\n        st.markdown('### Checkout (Mock Payment)')\n        name = st.text_input('Name', value='Commander Guru')\n        email = st.text_input('Email', value='acumenoutofguru@gmail.com')\n        address = st.text_area('Shipping Address', value='Tiruchirappalli, Tamil Nadu, India')\n        method = st.selectbox('Payment method (mock)', ['Razorpay (Demo)', 'Stripe (Demo)', 'Cash on Delivery'])\n        if st.button('Proceed to Pay (Mock)'):\n            with st.spinner('Processing payment...'):\n                time.sleep(2)\n            st.success('Payment succeeded (simulated)! üéâ')\n            order = {'name': name, 'email': email, 'address': address, 'items': get_cart_items(), 'total': total, 'method': method}\n            st.session_state.orders.append(order)\n            st.balloons()\n            st.write('Order summary:')\n            st.write(pd.DataFrame(order['items'])[['name','qty','total']])\n            # Optional: call Google Sheets logging function here if configured\n            st.session_state.cart = {}\n            st.experimental_rerun()\n\nst.markdown('---')\nst.subheader('Admin / Orders (local only)')\nif st.button('Show recent mock orders'):\n    st.write(pd.DataFrame(st.session_state.orders))\nst.caption('Built with ‚ù§Ô∏è by Commander Guru | Mock payments only ‚Äî no real payment processed')